# %% [markdown]
# # üß© Reto 2 ‚Äì pH
# **Objetivo:** clasificar pH y generar alerta qu√≠mica.
# 
# **Datos:** `../data/muestras_calidad_agua.csv`

# %% [markdown]
# ### Pasos
# 1. Carga el CSV en `df`.
# 2. Extrae `sitio` y `pH`.
# 3. Crea `clasificacion_pH` con tres rangos.
# 4. Crea `alerta_quimica` (revisi√≥n si pH < 6.5 o pH > 8.5).
# 5. Filtra `df_alerta` y exporta `resultado_ph.csv`.
# 
# > **Reto adicional:** promedio y desviaci√≥n est√°ndar.

# %% [markdown]
# # Reto 2 ‚Äì pH: Clasificaci√≥n y Alerta Qu√≠mica  
# 
# Curso: M√©todos N√∫mericos   
# Tema: Calidad del agua ‚Äì an√°lisis del pH  
# Autor: Camila Rico - Jackson Quintero - Julian Rodriguez
# 
# En este reto se busca analizar los valores de pH de diferentes fuentes h√≠dricas, clasificarlos seg√∫n su nivel de acidez o alcalinidad y generar alertas qu√≠micas cuando los valores est√©n fuera del rango √≥ptimo (6.5 ‚Äì 8.5).  
# 

# %%
# Instalaci√≥n de librer√≠as necesarias (solo ejecutar una vez)
%pip install pandas numpy


# %%
# Importar librer√≠as
import pandas as pd
import numpy as np

# Cargar el archivo CSV
df = pd.read_csv("../data/muestras_calidad_agua.csv")

# Mostrar las primeras filas
df.head()


# %% [markdown]
# ## Interpretaci√≥n inicial del pH  
# 
# El pH indica el grado de acidez o alcalinidad del agua:  
# - Valores menores a 7.0 ‚Üí medio √°cido
# - Valores iguales a 7.0 ‚Üí neutro
# - Valores mayores a 7.0 ‚Üí medio b√°sico (alcalino) 
# 
# Para determinar la calidad, se tomar√° como rango adecuado entre 6.5 y 8.5
# 

# %%
# Extraer solo las columnas 
df_ph = df[['sitio', 'pH']]
df_ph


# %% [markdown]
# ## Clasificaci√≥n de pH
# 
# Se crea una nueva columna llamada clasificacion_pH con base en los siguientes rangos:
# 
# - pH < 6.5 ‚Üí "√Åcido"  
# - 6.5 ‚â§ pH ‚â§ 8.5 ‚Üí "Neutro"  
# - pH > 8.5 ‚Üí "B√°sico"
# 

# %%
# Crear la clasificaci√≥n de pH
def clasificar_ph(valor):
    if valor < 6.5:
        return "√Åcido"
    elif valor <= 8.5:
        return "Neutro"
    else:
        return "B√°sico"

df_ph['clasificacion_pH'] = df_ph['pH'].apply(clasificar_ph)
df_ph


# %% [markdown]
# ## Generaci√≥n de alerta qu√≠mica  
# 
# Se genera una alerta cuando el pH est√° fuera del rango √≥ptimo (menor a 6.5 o mayor a 8.5).  
# La nueva columna se llama alerta_quimica y toma el valor "Revisar" o "Normal"
# 

# %%
# Crear columna de alerta qu√≠mica
df_ph['alerta_quimica'] = np.where(
    (df_ph['pH'] < 6.5) | (df_ph['pH'] > 8.5),
    "Revisar",
    "Normal"
)
df_ph


# %% [markdown]
# ## Filtrar sitios con alerta qu√≠mica  
# 
# A continuaci√≥n se muestran los sitios donde el pH requiere revisi√≥n
# 

# %%
# Filtrar los sitios que presentan alerta
df_alerta = df_ph[df_ph['alerta_quimica'] == 'Revisar']
df_alerta


# %% [markdown]
# ## Exportar resultados  
# 
# El resultado del an√°lisis se exporta a un archivo CSV llamado resultado_ph.csv para su uso posterior
# 

# %%
# Exportar los resultados
df_ph.to_csv("resultado_ph.csv", index=False)
print(" Archivo exportado como 'resultado_ph.csv'")


# %% [markdown]
# ## Reto adicional  
# 
# Calcular el promedio y la desviaci√≥n est√°ndar del pH en todas las muestras
# 

# %%
# C√°lculo estad√≠stico
promedio_ph = df_ph['pH'].mean()
desviacion_ph = df_ph['pH'].std()

print(f"Promedio del pH: {promedio_ph:.2f}")
print(f"Desviaci√≥n est√°ndar del pH: {desviacion_ph:.2f}")


# %% [markdown]
# ## Conclusi√≥n  
# 
# Se identifico los sitios con valores de pH fuera del rango √≥ptimo para la calidad del agua. Estos sitios deben ser revisados qu√≠micamente, ya que podr√≠an reflejar contaminaci√≥n o alteraciones naturales. Adem√°s, el c√°lculo del promedio y la desviaci√≥n est√°ndar ayuda a entender la variabilidad general del pH en la cuenca estudiada
# 


